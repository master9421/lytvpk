<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>LytVPK - L4D2 MOD管理工具</title>
  </head>
  <body>
    <div id="app">
      <!-- 加载界面 -->
      <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
          <div class="loading-spinner"></div>
          <p id="loading-message" class="loading-text">正在加载...</p>
        </div>
      </div>

      <!-- 主界面 -->
      <div id="main-screen" class="main-screen hidden">
        <!-- 头部工具栏 -->
        <header class="header">
          <div class="header-left">
            <h1>LytVPK</h1>
            <div class="directory-selector">
              <button id="select-directory-btn" class="btn btn-primary">
                <span class="icon">📁</span> 选择addons目录
              </button>
              <span id="current-directory" class="current-directory"></span>
            </div>
          </div>
          <div class="header-right">
            <button id="launch-l4d2-btn" class="btn btn-success" title="启动L4D2">
              <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
              </svg>
              <span>启动 L4D2</span>
            </button>
            <button id="workshop-btn" class="btn btn-primary" title="下载">
              <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              <span>下载</span>
            </button>
            <button id="server-favorites-btn" class="btn btn-primary" title="收藏服务器">
              <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
              </svg>
              <span>收藏服务器</span>
            </button>
            <button id="info-btn" class="btn-icon" title="关于">
              <span class="icon">🛈</span>
            </button>
          </div>
        </header>

        <!-- 搜索和筛选栏 -->
        <div class="filter-bar">
          <!-- 第一行：搜索、位置、批量操作 -->
          <div class="filter-row filter-row-main">
            <div class="search-box">
              <input
                type="text"
                id="search-input"
                placeholder="搜索VPK文件..."
                class="search-input"
              />
            </div>
            <div class="filter-section" id="location-filter-section">
              <!-- 动态生成位置筛选 -->
            </div>
            <div class="filter-actions">
              <button id="refresh-btn" class="btn btn-small btn-outline">
                <span class="icon">↻</span> 刷新
              </button>
              <button id="reset-filter-btn" class="btn btn-small btn-outline">
                <span class="icon">↻</span> 重置筛选
              </button>
            </div>
          </div>
          
          <!-- 第二行：标签筛选 -->
          <div class="filter-row filter-row-tags">
            <div id="tag-filters" class="tag-filters">
              <!-- 动态生成标签筛选按钮 -->
            </div>
          </div>
        </div>

        <!-- 文件列表 -->
        <div class="file-list-container">
          <div class="file-list-header">
            <div class="column-header checkbox-column"></div>
            <div class="column-header name-column">文件名</div>
            <div class="column-header size-column">大小</div>
            <div class="column-header status-column">状态</div>
            <div class="column-header location-column">位置</div>
            <div class="column-header tags-column">标签</div>
            <div class="column-header actions-column">操作</div>
          </div>
          <div id="file-list" class="file-list">
            <!-- 动态生成文件列表 -->
          </div>
        </div>

        <!-- 状态栏 -->
        <footer class="status-bar">
          <div class="status-info">
            <span id="total-files">总文件数: 0</span>
            <span id="enabled-files">已启用: 0</span>
            <span id="disabled-files">已禁用: 0</span>
            <span id="selected-files">已选择: 0</span>
          </div>
          <div class="status-actions">
            <button id="select-all-btn" class="btn btn-small btn-outline">
              <span class="icon">☑</span> 全选
            </button>
            <button id="deselect-all-btn" class="btn btn-small btn-outline">
              <span class="icon">☐</span> 取消全选
            </button>
            <button id="enable-selected-btn" class="btn btn-small btn-success">
              <span class="icon">✓</span> 启用选中
            </button>
            <button id="disable-selected-btn" class="btn btn-small btn-danger">
              <span class="icon">✗</span> 禁用选中
            </button>
            <button id="delete-selected-btn" class="btn btn-small btn-danger">
              <span class="icon">🗑️</span> 删除选中
            </button>
          </div>
        </footer>
      </div>

      <!-- 关于信息弹窗 -->
      <div id="info-modal" class="modal hidden">
        <div class="modal-content modal-small">
          <div class="modal-header">
            <h3>关于 LytVPK</h3>
            <button id="close-info-modal-btn" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div class="info-section">
              <div class="app-info">
                <h2 class="app-title">LytVPK</h2>
                <p class="app-subtitle">L4D2 MOD管理工具</p>
              </div>
              
              <div class="info-item">
                <label>作者:</label>
                <span>LaoYutang</span>
              </div>
              
              <div class="info-item">
                <label>GitHub:</label>
                <a href="https://github.com/LaoYutang/lytvpk" target="_blank" class="info-link">
                  https://github.com/LaoYutang/lytvpk
                </a>
              </div>
              
              <div class="info-item">
                <label>开源协议:</label>
                <a href="https://github.com/LaoYutang/lytvpk?tab=Apache-2.0-1-ov-file" target="_blank" class="info-link">
                  Apache-2.0
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 文件详情弹窗 -->
      <div id="file-detail-modal" class="modal hidden">
        <div class="modal-content">
          <div class="modal-header">
            <h3 id="detail-file-name">文件详情</h3>
            <button id="close-modal-header-btn" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div class="detail-section" id="preview-section">
              <h4>预览图</h4>
              <div class="preview-container">
                <img id="detail-preview-image" class="preview-image" alt="预览图" />
              </div>
            </div>
            <div class="detail-section" id="vpk-info-section">
              <h4>VPK信息</h4>
              <div class="detail-grid">
                <div class="detail-item">
                  <label>标题:</label>
                  <span id="detail-vpk-title"></span>
                </div>
                <div class="detail-item" id="detail-vpk-author-item">
                  <label>作者:</label>
                  <span id="detail-vpk-author"></span>
                </div>
                <div class="detail-item" id="detail-vpk-version-item">
                  <label>版本:</label>
                  <span id="detail-vpk-version"></span>
                </div>
                <div class="detail-item-full" id="detail-vpk-desc-item">
                  <label>描述:</label>
                  <span id="detail-vpk-desc"></span>
                </div>
              </div>
            </div>
            <div class="detail-section" id="map-info-section">
              <h4>地图信息</h4>
              <div class="map-info-content">
                <div class="campaign-name" id="detail-campaign"></div>
                <div class="chapters-list" id="detail-chapters-list">
                  <!-- 动态生成章节列表 -->
                </div>
              </div>
            </div>
            <div class="detail-section">
              <h4>基本信息</h4>
              <div class="detail-grid">
                <div class="detail-item">
                  <label>文件名:</label>
                  <span id="detail-name"></span>
                </div>
                <div class="detail-item">
                  <label>文件大小:</label>
                  <span id="detail-size"></span>
                </div>
                <div class="detail-item">
                  <label>位置:</label>
                  <span id="detail-location"></span>
                </div>
                <div class="detail-item">
                  <label>状态:</label>
                  <span id="detail-status"></span>
                </div>
                <div class="detail-item">
                  <label>最后修改:</label>
                  <span id="detail-modified"></span>
                </div>
              </div>
            </div>
            <div class="detail-section">
              <h4>标签</h4>
              <div id="detail-tags" class="tag-list">
                <!-- 动态生成标签 -->
              </div>
            </div>
            <div class="detail-section">
              <h4>详细标签</h4>
              <div id="detail-detail-tags" class="tag-list">
                <!-- 动态生成详细标签 -->
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- 下载模态框 -->
      <div id="workshop-modal" class="modal hidden">
        <div class="modal-content workshop-modal-content">
          <div class="modal-header">
            <h2>下载</h2>
            <button id="close-workshop-modal-btn" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div class="input-group">
              <label for="workshop-url" style="margin-bottom: 8px; display: block; font-weight: 500;">创意工坊链接</label>
              <div class="url-input-container">
                <input type="text" id="workshop-url" placeholder="粘贴 Steam 创意工坊链接..." />
                <button id="check-workshop-btn" class="btn btn-primary">解析</button>
              </div>
            </div>

            <div class="input-group" style="margin-top: 15px;">
              <label for="download-url" style="margin-bottom: 8px; display: block; font-weight: 500;">下载链接</label>
              <div class="url-input-container">
                <input type="text" id="download-url" placeholder="解析后自动填充，或手动输入直链..." />
                <button id="copy-url-btn" class="btn btn-secondary">复制</button>
                <button id="download-workshop-btn" class="btn btn-success">下载</button>
              </div>
            </div>

            <div id="workshop-result" class="workshop-result hidden" style="margin-top: 20px;">
              <div class="workshop-info" style="display: flex; gap: 20px; margin-bottom: 20px;">
                <img id="workshop-preview" src="" alt="Preview" class="workshop-preview" style="max-width: 200px; max-height: 200px; object-fit: cover; border-radius: 4px;" />
                <div class="workshop-details">
                  <h3 id="workshop-title" style="margin-top: 0;"></h3>
                  <p><strong>文件名:</strong> <span id="workshop-filename"></span></p>
                  <p><strong>大小:</strong> <span id="workshop-filesize"></span></p>
                  <p id="workshop-creator-container"><strong>作者:</strong> <span id="workshop-creator"></span></p>
                </div>
              </div>
            </div>

            <div class="workshop-actions" style="text-align: right; margin-top: 20px; display: none;">
              <!-- Button moved to input group -->
            </div>

            <div class="task-list-container" style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3>下载任务队列</h3>
                <button id="clear-completed-tasks-btn" class="btn btn-sm btn-outline">清理已完成</button>
              </div>
              <div id="download-tasks-list" class="download-tasks-list" style="max-height: 300px; overflow-y: auto;">
                <!-- 任务列表项将动态插入这里 -->
                <div class="empty-tasks" style="text-align: center; color: #888; padding: 20px;">暂无下载任务</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 确认对话框 -->
      <div id="confirm-modal" class="modal hidden">
        <div class="modal-content confirm-modal-content">
          <div class="modal-header">
            <h2 id="confirm-title">确认</h2>
            <button id="close-confirm-modal-btn" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <p id="confirm-message" class="confirm-message"></p>
          </div>
          <div class="modal-footer">
            <button id="confirm-cancel-btn" class="btn btn-secondary">取消</button>
            <button id="confirm-ok-btn" class="btn btn-primary">确定</button>
          </div>
        </div>
      </div>

      <!-- 服务器收藏对话框 -->
      <div id="server-modal" class="modal hidden">
        <div class="modal-content server-modal-content">
          <div class="modal-header">
            <h2>服务器收藏</h2>
            <button id="close-server-modal-btn" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div class="server-toolbar" style="display: flex; justify-content: space-between; margin-bottom: 15px;">
              <button id="open-add-server-modal-btn" class="btn btn-success">
                <span class="icon">➕</span> 添加服务器
              </button>
              <button id="refresh-all-servers-btn" class="btn btn-outline" title="刷新所有服务器">
                  <span class="icon">↻</span> 刷新
              </button>
            </div>
            <div class="server-list-container">
              <ul id="server-list" class="server-list">
                <!-- 动态生成服务器列表 -->
              </ul>
            </div>
            
            <div class="server-data-section" style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-light);">
              <div class="server-data-header" id="toggle-data-mgmt-btn" style="margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; user-select: none;">
                <h3 style="font-size: 0.9rem; color: var(--text-secondary); margin: 0;">数据管理</h3>
                <span class="icon">▼</span>
              </div>
              <div id="server-data-container" class="server-data-actions hidden" style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button id="export-clipboard-btn" class="btn btn-small btn-outline" title="导出到剪贴板">
                  <span class="icon">📋</span> 复制配置
                </button>
                <button id="export-file-btn" class="btn btn-small btn-outline" title="导出到文件">
                  <span class="icon">💾</span> 导出文件
                </button>
                <button id="import-clipboard-btn" class="btn btn-small btn-outline" title="从剪贴板导入">
                  <span class="icon">📋</span> 粘贴导入
                </button>
                <button id="import-file-btn" class="btn btn-small btn-outline" title="从文件导入">
                  <span class="icon">📂</span> 文件导入
                </button>
                <input type="file" id="import-file-input" accept=".json" style="display: none;">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- 全局下拉菜单 -->
      <div id="global-dropdown" class="dropdown-content fixed-dropdown hidden">
        <button id="global-edit-server-btn" class="dropdown-item">
          <span class="icon">✏️</span> 编辑
        </button>
        <button id="global-delete-server-btn" class="dropdown-item danger">
          <span class="icon">🗑️</span> 删除
        </button>
      </div>

      <!-- 编辑/添加服务器模态框 -->
      <div id="server-form-modal" class="modal hidden" style="z-index: 1060;">
        <div class="modal-content server-modal-content" style="max-width: 450px; border-radius: 12px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);">
          <div class="modal-header" style="border-bottom: 1px solid var(--border-light); padding-bottom: 15px; margin-bottom: 20px;">
            <h2 id="server-form-title" style="font-size: 1.25rem; color: var(--text-primary);">编辑服务器</h2>
            <button id="close-server-form-modal-btn" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group" style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary);">服务器名称</label>
              <input type="text" id="form-server-name" class="form-input" style="width: 100%;" placeholder="例如: My L4D2 Server">
            </div>
            <div class="form-group" style="margin-bottom: 20px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary);">服务器地址 (IP:Port)</label>
              <input type="text" id="form-server-address" class="form-input" style="width: 100%;" placeholder="例如: 127.0.0.1:27015">
            </div>
            <div class="form-group" style="margin-bottom: 25px;">
              <label style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-secondary);">排序权重</label>
              <div style="display: flex; align-items: center; gap: 10px;">
                <input type="number" id="form-server-weight" class="form-input" style="width: 100px;" value="0">
                <span style="font-size: 0.85rem; color: var(--text-tertiary);">数值越大，排序越靠前</span>
              </div>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; padding-top: 10px;">
              <button id="cancel-server-form-btn" class="btn btn-secondary" style="padding: 8px 20px;">取消</button>
              <button id="save-server-form-btn" class="btn btn-primary" style="padding: 8px 20px;">保存</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 退出确认对话框 -->
      <div id="exit-confirm-modal" class="modal hidden">
        <div class="modal-content confirm-modal-content">
          <div class="modal-header">
            <h2>确认退出</h2>
            <button id="close-exit-modal-btn" class="close-btn">&times;</button>
          </div>
          <div class="modal-body">
            <p>当前有正在进行的下载任务，退出将导致任务中断。<br>确定要退出吗？</p>
          </div>
          <div class="modal-footer">
            <button id="exit-cancel-btn" class="btn btn-secondary">取消</button>
            <button id="exit-confirm-btn" class="btn btn-danger">退出</button>
          </div>
        </div>
      </div>

    </div>
    <script src="./src/main.js?v=1.6" type="module"></script>
  </body>
</html>
